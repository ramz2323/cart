---
title: "animal_age"
author: "Ramzi Saud"
date: "April 7, 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, tidyr, here, ggplot2, RColorBrewer, rpart, rpart.plot)
theme_set(theme_bw())
options(scipen = 999)
```

```{r data processing}
data <- read.table(here("anage_data.txt"), sep = '\t', header=TRUE, quote = "\"")

str(data)

#Replace periods with underscores in field names
names(data) <- gsub(".", "_", names(data), fixed = T)

summary(data$Maximum_longevity__yrs_)
summary(data$Class)

#View the animal with the highest longevity
data %>% 
  filter(Maximum_longevity__yrs_ == max(Maximum_longevity__yrs_))

#Removing observations without a maximum longevity
data <- data %>%
  drop_na(Maximum_longevity__yrs_)

#Only working with mammals
data <- data %>%
  filter(Class == "Mammalia")

data <- data %>%
  mutate(Adult_weight__kg_ = Adult_weight__g_ / 1000 )

data$Order <- factor(data$Order)

#Split into train and test
index <- sample(1:nrow(data),size = ceiling(0.8*nrow(data)),replace = FALSE)
train <- data[index,]
test <- data[-index,]
```


```{r tree}
tree1 <- rpart(Maximum_longevity__yrs_ ~ Adult_weight__kg_ + Gestation_Incubation__days_ + Female_maturity__days_ + Male_maturity__days_ , train, method = "anova", parms = list(split = 'gini'))

rpart.plot(tree1, extra = 101, branch = .5, box.palette = "RdYlGn", prefix = "Longevity_yr\n", fallen.leaves = F, tweak = 1.3)

printcp(tree1)
plotcp(tree1)



```

